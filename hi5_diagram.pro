FUNCTION logticks_exp, axis, index, value 

; Determine the base-10 exponent 
 exponent = LONG( ALOG10( value ) ) 
; Construct the tickmark string based on the exponent 
tickmark = '10!E' + STRTRIM( STRING( exponent ), 2 ) + '!N' 
; Return the formatted tickmark string 

RETURN, tickmark
END 

PRO HI5_DIAGRAM

; Fixed parameters
m2r=   4.848136811D-9       ; Convert milli arc seconds to radians
r2m=   206264806.246D0      ;         radians --> mas
m2d=   2.7777777777778D-7   ;         mas --> degrees
r2d=   57.2957795128D0      ;         radians --> degrees
d2r=   1.74532925199D-2     ;         degrees --> radians
sr2as2=4.25451703D+10       ;         sr --> arcsecï¿½
s2day= 1D0/8.64D+4          ;         sec --> day
d2a=   0.88622692545D0      ; =0.5*SQRT(pi): converts telescope diameter into area, after squaring
AU=    1.495978D+11         ; [m]
pc=    3.085678D+16         ; [m]
; Solar parameters
msun=  1.989D+30            ; [kg]
tsun=  5777.                ; [K]
rsun=  6.96D8               ; [m]     solar radius
lsun=  3.9D+26              ; [W]
; Earth parameters
day =  86400D0              ; [s]
year=  31558118.4D0         ; [s]
mear=  5.98D+24             ; [kg]
tear=  265.                 ; [K]
rear=  6378500.             ; [m]
lear=  1.                   ; [W]
eear=  0.017                ;         eccentricity
; Jupiter parameters
rjup = 11.2*rear
mjup = 2D27 ;[kg]

wav   = 2.2D-6

; Define isntruments
pio_con = 2D-3 & pio_wav = 1.65D-6 & pio_bas = 201. & pio_fov = 200. ; mas
gra_con = 2D-3 & gra_wav = 2.20D-6 & gra_bas = 201. & gra_fov = 140. ; mas
flu_con = 2D-3 & flu_wav = 2.20D-6 & flu_bas = 330. & flu_fov = 1D3
kin_con = 1D-3 & kin_wav = 8.7D-6  & kin_bas = 85.5 & kin_fov = 100.
lbt_con = 4D-4 & lbt_wav = 1.10D-5 & lbt_bas = 14.4 & lbt_fov = 1D3
pfn_con = 3D-4 & pfn_wav = 2.20D-6 & pfn_bas = 3.2  & pfn_fov = 275.
mat_con = 3D-3 & mat_wav = 3.8D-6  & mat_bas = 140  & mat_fov = 600.  ; Assuming 140m UT baseline
sam_con = 3D-4 & sam_wav = 2.20D-6 & sam_bas = 8.2  & sam_fov = 600.

; Compute resolution
pio_res = 0.5*pio_wav/pio_bas/m2r;*1D-3
gra_res = 0.5*gra_wav/gra_bas/m2r;*1D-3
mat_res = 0.5*mat_wav/mat_bas/m2r;*1D-3
kin_res = 0.5*kin_wav/kin_bas/m2r;*1D-3
lbt_res = 0.5*lbt_wav/lbt_bas/m2r;*1D-3
pfn_res = 0.5*pfn_wav/pfn_bas/m2r;*1D-3
flu_res = 0.5*flu_wav/flu_bas/m2r;*1D-3
sam_res = 0.5*sam_wav/sam_bas/m2r;*1D-3
elt_res = wav/39/m2r
nac_res = wav/8.2/m2r
vlt_res = 0.5*wav/mat_bas/m2r

; Arrange stuff
res = [pio_res, gra_res, mat_res, kin_res, lbt_res, pfn_res, flu_res, sam_res]
fov = [pio_fov, gra_fov, mat_fov, kin_fov, lbt_fov, pfn_fov, flu_fov, sam_fov]
con = [pio_con, gra_con, mat_con, kin_con, lbt_con, pfn_con, flu_con, sam_con]
col = [40, 40, 100, 150, 150, 40, 40, 40]
sym = [8, 8, 5, 4, -4, 8, 8, 8]
ni  = N_ELEMENTS(col)

; Plot data

A = FIndGen(40) * (!PI*2/40.)
UserSym, cos(A), sin(A), /fill

xrange = [0.5,500.]
yrange = [1D-6,1D-1]
result_path = '/Users/ddefrere/IDLWorkspace/Divers/models/Hi-5/'
PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'hi5_diagram.eps', /ENCAPS, /COLOR, XSIZE=17.8, YSIZE=13.2, /TIMES
PLOT, [pio_res,pio_fov], [pio_con,pio_con],  /XLOG, /YLOG, XTITLE='Inner working angle [mas]', YTITLE='Interferometric Contrast', TITLE=' ', XSTYLE=1, YSTYLE=1, COLOR=0, POSITION=posleft1,$
      YTICKNAME=ytickname, XRANGE=xrange, YRANGE=yrange, YTICKFORMAT='logticks_exp' , /NODATA
LOADCT, 0, /SILENT
;OPLOT, mid_res, [mid_con,mid_con], COLOR=150, THICK=50
LOADCT, 4, /SILENT
FOR i=0, ni-1 DO BEGIN
  OPLOT, [res[i]], [con[i]], COLOR=col[i], PSYM=sym[i], SYMSIZE=1.4
ENDFOR
OPLOT, [170,190]*1D-3, [0.012,0.012], COLOR=150, THICK=50 & XYOUTS, 143*1D-3, 0.0105, ' MID-IR', COLOR=150, CHARSIZE=1.1
OPLOT, [170,190]*1D-3, [0.026,0.026], COLOR=100, THICK=50 & XYOUTS, 105*1D-3, 0.023, 'THERMAL NEAR-IR', COLOR=100, CHARSIZE=1.1
OPLOT, [170,190]*1D-3, [0.056,0.056], COLOR=40, THICK=50  & XYOUTS, 141*1D-3, 0.0505, 'NEAR-IR', COLOR=40, CHARSIZE=1.1
DEVICE, /CLOSE & END_PS

A = FIndGen(48) * (!PI*2/48.)
UserSym, 3*cos(A), sin(A), /fill

; Values from Absil et al. 2016
x = [0.09298999,0.12732475,0.23748212,0.3090129,0.40772533,0.50214595,0.6180258,0.73819745,0.88412017,0.99427754,0.99427754]*1000
y = 10^([4.9503484,5.7644954,7.350796,8.110622,9.080728,9.696287,10.257017,10.799459,11.264546,11.504548,11.504548]/(-2.5))
x = [0.20, 0.3090129,0.40772533,0.50214595,0.6180258,0.73819745,0.88412017,0.99427754,0.99427754]*1000
y = 10^([7.050796,8.110622,9.080728,9.696287,10.257017,10.799459,11.264546,11.504548,11.504548]/(-2.5))/5
print, y

; Values from Hinckley 2009
x2 = [30.656874, 25.482527 ,40.733788  ,  47.645367, 60.59634  ,92.46987,  120.74288 ,151.2749 ,179.06439  ,203.16444  ,240.63087  ,269.2494]
y2 = 1./[287.66772, 178.99178,  568.15344,  913.3422, 1243.229  ,1431.6403, 1261.3909,  1367.5122,  1310.062, 1204.5841 ,1333.9159  ,1278.5238]/5.

; Values from Hinckley 2009
x3 = [0.7,10]
y3 = [2D-3,2D-3]

xrange = [0.5,1000.]
yrange = [1D-6,1D-1]
PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'hi5_diagram2.eps', /ENCAPS, /COLOR, XSIZE=17.8, YSIZE=13.2, /TIMES
PLOT, [pio_res,pio_fov], [pio_con,pio_con],  /XLOG, /YLOG, XTITLE='Angular separation [mas]', YTITLE='K-band contrast', TITLE=' ', XSTYLE=1, YSTYLE=1, COLOR=0, POSITION=posleft1,$
      CHARSIZE=1.6, YTICKNAME=ytickname, XRANGE=xrange, YRANGE=yrange, YTICKFORMAT='logticks_exp' , /NODATA


LOADCT, 0, /SILENT

; Read exoplanet data
plntfile = result_path + 'planets.csv'
pln_data = READ_CSV(plntfile, TABLE_HEADER=thdr, HEADER=hdr, N_TABLE_HEADER=306  )
print, hdr

s_name = pln_data.(WHERE(hdr EQ 'hostname') )
p_mass = pln_data.(WHERE(hdr EQ 'pl_msinij') )
p_rad  = pln_data.(WHERE(hdr EQ 'pl_radj') )
p_teff = pln_data.(WHERE(hdr EQ 'pl_eqt') )
p_sma  = pln_data.(WHERE(hdr EQ 'pl_orbsmax'))
p_tor  = pln_data.(WHERE(hdr EQ 'pl_orbper'))
s_dist = pln_data.(WHERE(hdr EQ 'sy_dist') )
s_dec  = pln_data.(WHERE(hdr EQ 'dec') )
s_rad  = pln_data.(WHERE(hdr EQ 'st_rad'))
s_mass = pln_data.(WHERE(hdr EQ 'st_mass'))
s_lum  = 10^pln_data.(WHERE(hdr EQ 'st_lum'))
s_teff = pln_data.(WHERE(hdr EQ 'st_teff'))
s_spt  = pln_data.(WHERE(hdr EQ 'st_spectype'))
s_met  = pln_data.(WHERE(hdr EQ 'discoverymethod'))
n_spec = pln_data.(WHERE(hdr EQ 'st_nspec'))
s_vm   = pln_data.(WHERE(hdr EQ 'sy_vmag'))
s_km   = pln_data.(WHERE(hdr EQ 'sy_kmag'))
p_ang  = p_sma*AU/(s_dist*pc)/m2r

; REplace missing data
idx = WHERE(STRMATCH(s_name, 'HR 8799', /FOLD_CASE))
p_teff[idx] = 1000.
p_rad[idx] = 1.2

idx = WHERE(STRMATCH(s_name, 'bet pic', /FOLD_CASE))
p_teff[idx] = 1600.

; Estimate stellar radius when absent
idx_null        = WHERE(s_rad LE 0)
s_rad[idx_null] = (s_mass[idx_null])^0.3333

; Estimate stellar temperature when absent based on Allen
idx_null = WHERE(s_teff LE 0 OR s_teff GT 1E5, n_null)
sp_class = ["O5","O6","O7","O8","O9","B0","B1","B2","B3","B5","B6","B7","B8","B9","A0","A1","A2","A3","A4","A5","A7","F0","F2","F3","F5","F6","F7","F8","G0","G1","G2","G5","G8","K0","K1","K2","K3","K4","K5","K7","K8","M0","M1","M2","M3","M4","M5","M6","M7","M8","L0","L3","L8","T2","T6","T8"]
t_class  = [54000,45000,43300,40600,37800,29200,23000,21000,17600,15200,14300,13500,12300,11400,9600,9330,9040,8750,8480,8310,7920,7350,7050,6850,6700,6550,6400,6300,6050,5930,5800,5660,5440,5240,5110,4960,4800,4600,4400,4000,3850,3750,3700,3600,3500,3400,3200,3100,2900,2700,2600,2200,1500,1400,1000,800]
m_class  = [32.7,29.5,28.3,25.2,22.6,17.8,11.7,10,7.32,5.46,4.79,4.1,3.41,2.91,2.48,2.35,2.25,2.13,2.03,1.98,1.86,1.59,1.46,1.39,1.33,1.22,1.12,1.1,1.05,1.03,1,0.91,0.82,0.76,0.72,0.7,0.67,0.61,0.58,0.53,0.49,0.44,0.38,0.36,0.34,0.28,0.22,0.19,0.17,0.098,0.078,0.052,0.048,0.032,0.028]

;IF i2 LE 3 THEN BEGIN
;  sp_class = ["G5","G8","K0","K1","K2","K3","K4","K5","M0","M1","M2","M3","M4","M5","M6"]
; t_class  = [5010,4870,4720,4580,4460,4210,4010,3780,3660,3600,3500,3300,3100,2950,2800]
;ENDIF
FOR i = 0, n_null-1 DO BEGIN
  ii         = idx_null[i]
  idx        = WHERE(STRMID(s_spt[ii], 0, 2) EQ sp_class, nok)
  IF nok GT 0 THEN BEGIN
    s_teff[ii] = MEAN(t_class[idx])
    PRINT, STRMID(s_spt[ii], 0, 2), s_teff[ii]
  ENDIF ELSE BEGIN
    idx = WHERE(ABS(s_mass[ii]-m_class) EQ MIN(ABS(s_mass[ii]-m_class)), nok)  
    s_teff[ii] = MEAN(t_class[idx])
    PRINT, s_teff[ii], s_rad[ii], s_mass[ii]
  ENDELSE
ENDFOR

; Estimate mass when absent
idx_null = WHERE(s_mass LE 0, n_null)
FOR i = 0, n_null-1 DO BEGIN
  ii         = idx_null[i]
  idx        = WHERE(STRMID(s_spt[ii], 0, 2) EQ sp_class, nok)
  IF nok GT 0 THEN BEGIN
    s_mass[ii] = MEAN(m_class[idx])
    PRINT, STRMID(s_spt[ii], 0, 2), s_mass[ii]
  ENDIF
ENDFOR

; Some stars are still missing after that
idx_null        = WHERE(s_rad LE 0)
s_rad[idx_null] = s_mass[idx_null]^0.333
s_lum           = s_rad^2/(tsun/s_teff)^2

; Some stars are still missing after that
idx_null        = WHERE(s_rad LE 0)
s_rad[idx_null] = (tsun/s_teff[idx_null])^2*SQRT(s_lum[idx_null])

; Some stars are still missing after that
idx_null         = WHERE(s_mass LE 0)
s_mass[idx_null] = s_rad[idx_null]^3

; Estimate radius when absent
idx_null        = WHERE(p_rad EQ 0)
p_rad[idx_null] = (p_mass[idx_null])^0.3333 ; Rough estimate

; Estimate mass when absent
;idx_null         = WHERE(p_mass EQ 0)
;p_mass[idx_null] = (p_rad[idx_null])^3 ; Rough estimate

; Estimate planet SMA when absent
idx_null = WHERE(p_sma LE 0, n)
FOR i=0, n-1 DO BEGIN
  ii = idx_null[i]
  G  = 6.67408D-11 ;m3 kg-1 s-2
  p_sma[ii] = ((G*s_mass[ii]*msun*(p_tor[ii]*24.*60.*60)^2/4./!dpi^2)^(1./3.))/AU
  ;PRINT, p_sma[ii], s_mass[ii], p_tor[ii]
ENDFOR
 
; Estimate temperature when absent
a      = 0.3
idx_null = WHERE(p_teff LE 100)
p_teff[idx_null] = s_teff[idx_null]*SQRT(0.5*s_rad[idx_null]*rsun/p_sma[idx_null]/AU)*(1-a)^0.25 ; Rough estimate
;p_teff = s_teff*SQRT(0.5*s_rad*rsun/p_sma/AU)*(1-a)^0.25 ; Rough estimate

; Remove planets for which the teff is too small
idx_srt = SORT(p_teff)
idx_out = WHERE(p_teff[idx_srt] LE 0, n_out, COMPLEMENT=idx_keep) 
IF n_out GT 0 THEN BEGIN
  idx_keep = idx_srt[idx_keep]
  s_name = s_name[idx_keep]
  p_mass = p_mass[idx_keep]
  p_rad  = p_rad[idx_keep]
  p_teff = p_teff[idx_keep]
  p_sma  = p_sma[idx_keep]
  p_tor  = p_tor[idx_keep]
  s_dist = s_dist[idx_keep]
  s_dec  = s_dec[idx_keep]
  s_rad  = s_rad[idx_keep]
  s_mass = s_mass[idx_keep]
  s_lum  = s_lum[idx_keep]
  s_teff = s_teff[idx_keep]
  s_spt  = s_spt[idx_keep]
  s_met  = s_met[idx_keep]
  n_spec = n_spec[idx_keep] 
  s_vm   = s_vm[idx_keep] 
  s_km   = s_km[idx_keep] 
  p_ang  = p_sma*AU/(s_dist*pc)/m2r
ENDIF

idx = WHERE(p_teff LT 100, n)
FOR i=0, n-1 DO print, p_teff[idx[i]], s_teff[idx[i]], s_lum[idx[i]], s_rad[idx[i]]

; Teff hack
p_teff[WHERE(p_teff GT 2500)] = 2500
p_teff[WHERE(p_teff LT 100)]  = 100
 
; Compute flux
s_flx = BLACKBODY(s_teff, wav, STANDARD=standard)*(!dpi*(s_rad*rsun/s_dist/pc)^2)
p_flx = BLACKBODY(p_teff, wav, STANDARD=standard)*(!dpi*(p_rad*rjup/s_dist/pc)^2)
ctr   = p_flx/s_flx

; Check direct imaged planets
idx = WHERE(STRMATCH(s_name, 'HR 8799', /FOLD_CASE))
print, s_name[idx], s_rad[idx], s_teff[idx], p_teff[idx], p_sma[idx], p_ang[idx], p_rad[idx], p_mass[idx], ctr[idx]

idx = WHERE(ctr GT 1D-2)
print, s_name[idx], s_rad[idx], s_teff[idx], p_teff[idx], p_sma[idx], p_ang[idx], p_rad[idx], p_mass[idx], ctr[idx]
ctr[idx] = 1D-12 ; remove from plot
  
;x4 = [1.986754967,1.059375,0.830350752,0.687830688,0.441329011,0.416666667,0.398230088,0.389428359,0.365479452,0.342156863,0.330097087,0.267241379,0.261261261,0.257695061,0.249637155,0.246696035,0.246323529,0.238095238,0.227272727,0.211925043,0.199909747,0.198895028,0.195934959,0.189309577,0.179039301,0.171111111,0.16344294,0.15443038,0.153038674,0.150322119,0.148658448,0.148221344,0.14739726,0.138236107,0.136774194,0.132420604,0.130397727,0.13034188,0.128581544,0.127787934,0.127179487,0.124558304,0.11734104,0.116515837,0.114722753,0.114583333,0.114545455,0.109767892,0.10955711,0.108090615,0.106024096,0.105783702,0.103869654,0.102325581,0.100816327,0.099118943,0.098039216,0.0978,0.097721519,0.095571622,0.095180723,0.094814815,0.094068228,0.09299588,0.092765957,0.08754717,0.086792453,0.086681818,0.086294416,0.085060606,0.084471703,0.083993399,0.083769634,0.083601286,0.083516484,0.083489097,0.082963901,0.081675836,0.081415929,0.080263158,0.080188679,0.079539642,0.079515335,0.078954248,0.078787879,0.078481013,0.078468006,0.07811362,0.078014184,0.077666774,0.076876877,0.076208178,0.07602649,0.075904227,0.074509804,0.073489519,0.072115385,0.071463534,0.07112766,0.069271758,0.068891281,0.067931034,0.067304015,0.06685666,0.066575342,0.066339066,0.066204819,0.065447898,0.064088398,0.063919822,0.063877551,0.063685152,0.063449508,0.063292812,0.062727273,0.062666126,0.062477231,0.061478599,0.060196078,0.060066007,0.05958231,0.059428571,0.059405941,0.059169765,0.058974359,0.057913887,0.057818182,0.057782693,0.056862745,0.055868545,0.055384615,0.054909091,0.053873034,0.053398058,0.053,0.052665245,0.052430887,0.051818182,0.05166745,0.050789474,0.050647821,0.050517104,0.05,0.049815951,0.04978355,0.049514563,0.048672566,0.047192982,0.046875,0.046666667,0.046296296,0.046182846,0.045862069,0.045575811,0.045427376,0.045150502,0.045013477,0.044758539,0.044739292,0.044623656,0.044322766,0.044049734,0.044012282,0.043468468,0.043430657,0.043335761,0.042966752,0.042694497,0.042222222,0.041607565,0.040598291,0.04048583,0.04047619,0.040350877,0.040029139,0.039393939,0.039183673,0.039124088,0.038966049,0.038823529,0.038728324,0.038664323,0.038588235,0.038339811,0.038256228,0.038191882,0.037900875,0.037777778,0.037451737,0.036709657,0.036486486,0.036438356,0.036428571,0.03634,0.036091371,0.035919732,0.035910672,0.035727788,0.035567715,0.035072464,0.034877927,0.034477451,0.034119782,0.033422973,0.033421053,0.033182796,0.032646048,0.032477575,0.032458564,0.032142857,0.031910112,0.031785714,0.031315789,0.031140351,0.030909091,0.030888031,0.030701754,0.030638298,0.030555556,0.029961089,0.029555149,0.029320988,0.029136364,0.029110429,0.029090909,0.02890933,0.028511236,0.028508772,0.028490566,0.028421053,0.027948718,0.027887324,0.027872799,0.027809308,0.027807487,0.02757234,0.027521472,0.027291667,0.027166788,0.027055703,0.026936027,0.026818182,0.026631158,0.026142132,0.026,0.025937145,0.025806452,0.025766871,0.025666667,0.025528169,0.025405405,0.025296804,0.025253807,0.025,0.024932249,0.024832962,0.024473684,0.023973947,0.023943662,0.023920863,0.02372093,0.02362949,0.023597065,0.023574468,0.023421053,0.023411371,0.023406433,0.023318386,0.0231625,0.023148148,0.022955912,0.022925764,0.022807018,0.022623574,0.022335845,0.022301762,0.022222222,0.022200198,0.022,0.021916168,0.021818182,0.02175,0.021428571,0.021061947,0.020957096,0.020898773,0.020807834,0.020745921,0.02071,0.020708475,0.020661765,0.020177936,0.020109034,0.019988849,0.019777778,0.019507576,0.019439868,0.019414063,0.019366053,0.019234198,0.019145803,0.019048936,0.019,0.018975332,0.018876941,0.018281536,0.018281536,0.018274854,0.018264463,0.017911092,0.017857143,0.017820856,0.0175,0.01749409,0.017420814,0.017389966,0.017313433,0.017102616,0.016934801,0.016909091,0.016826923,0.016757741,0.016620499,0.016589147,0.016568047,0.01650519,0.016233766,0.016170909,0.016113744,0.016094675,0.01587234,0.015857284,0.01574344,0.015686275,0.015682968,0.01554,0.01547619,0.015443011,0.015343066,0.015250545,0.015175,0.015142341,0.015019355,0.014918626,0.014883721,0.014864182,0.014833127,0.014767932,0.014761905,0.014734375,0.014671952,0.014671815,0.014666667,0.014222222,0.014042208,0.013817035,0.013647643,0.01352459,0.013441955,0.013266315,0.0132,0.012961022,0.012887029,0.012740775,0.012721519,0.012706731,0.012636364,0.012510152,0.012339623,0.012230216,0.012162162,0.012105263,0.012079969,0.012047782,0.011890244,0.01187291,0.011864407,0.01184,0.011834862,0.011755233,0.011663653,0.011560694,0.011473597,0.011464968,0.011333333,0.011285714,0.011219008,0.011082803,0.011,0.010863874,0.010863309,0.010837989,0.010606061,0.010573477,0.010477941,0.01046875,0.010416667,0.01040404,0.01037037,0.01035914,0.010302457,0.010245902,0.010091743,0.010071942,0.01005,0.010019792,0.009922481,0.009904887,0.009880952,0.009749304,0.009596579,0.009313725,0.009312977,0.009300699,0.009250399,0.009232143,0.009188817,0.009179104,0.009118541,0.008945768,0.008873435,0.008741259,0.00870678,0.008686131,0.008659794,0.008592593,0.008590308,0.008499096,0.008412698,0.008238994,0.008055381,0.008046875,0.008010615,0.007956989,0.007950225,0.007841091,0.00779896,0.007694472,0.007677778,0.007574032,0.007477906,0.007437458,0.007383041,0.007367281,0.00725,0.007111111,0.00705,0.006973924,0.006867284,0.006850254,0.006847849,0.006833333,0.006792453,0.00675,0.006739258,0.006641077,0.006637168,0.006602254,0.006565657,0.006558401,0.006447727,0.006388889,0.00634375,0.006313131,0.006265823,0.006230159,0.006229508,0.006217532,0.006031746,0.005944444,0.005943791,0.005892136,0.005812133,0.005805556,0.005778495,0.005558659,0.005542056,0.005513439,0.005490196,0.005462555,0.005388128,0.005365517,0.005243665,0.005217391,0.00505071,0.005030488,0.005025554,0.005,0.004974745,0.004889299,0.004878971,0.004773504,0.004673118,0.004665227,0.004631579,0.004586592,0.004516729,0.004508857,0.004431075,0.004426947,0.004380104,0.004361111,0.004325,0.004266667,0.004158607,0.004075235,0.003852814,0.003715203,0.003710938,0.003701826,0.003647619,0.003602941,0.003591258,0.003566038,0.003537415,0.003472222,0.003409091,0.003371429,0.003335031,0.003263959,0.003191946,0.00316129,0.003132729,0.003079824,0.003059273,0.003027888,0.002952555,0.002950201,0.002948718,0.002933333,0.002709402,0.002700617,0.002644542,0.002592593,0.002575107,0.002478723,0.00239819,0.002367242,0.002162921,0.00214,0.002040816,0.001953488,0.001833465,0.001765133,0.001764706,0.001727116,0.001705556,0.001693668,0.001690821,0.001666667,0.001638298,0.001629213,0.001626904,0.001589595,0.001589496,0.001507421,0.001506748,0.001425061,0.001359268,0.001327014,0.001321353,0.001308129,0.001274194,0.001272727,0.001269488,0.001266667,0.001227545,0.001213793,0.001197115,0.001157143,0.001076271,0.001068182,0.001013699,0.001005587,0.000946611,0.000932476,0.000921368,0.000906324,0.000902013,0.000852,0.000825397,0.000820771,0.000819214,0.000790068,0.000778234,0.000776892,0.000744186,0.00069697,0.000683112,0.000642857,0.000630872,0.000602857,0.000554871,0.000496562,0.000487239,0.000435115,0.000428571,0.000411341,0.000397143,0.000338759,0.000306667,0.000204787]
;z4 = [-82.4613105,-15.6059214,-22.67810925,-16.57150731,-17.68287267,-32.25610044,-26.4553105,-13.60436169,-12.3260099,-15.23016247,-16.56213913,-15.91246161,-16.28420914,-13.82859708,-12.98322475,-13.89649338,-18.97478905,-16.68926761,-20.51505768,-16.27085061,-13.22399851,-15.58199481,-28.11637517,-9.529620651,-11.80639329,-23.26126507,-7.509796317,-18.19265889,-13.07086552,-10.65639215,-8.481942224,-19.40561731,-8.955056157,-15.32416288,-17.18152899,-11.25817781,-16.02313321,-7.079254622,-19.56067281,-17.54848806,-15.22609638,-19.18572023,-10.31852809,-15.84939902,-15.8524075,-13.24114456,-13.26819501,-13.9320358,-18.76249447,-13.05088383,-11.38568745,-13.59799543,-14.51129145,-9.762102577,-14.11368014,-10.50012259,-9.088098665,-14.98591481,-7.788971478,-12.64098491,-16.06679744,-15.65761466,-9.710885173,-12.15386336,-16.01137293,-10.93807145,-9.975062276,-13.92015849,-13.49697366,-14.64329295,-12.56465412,-8.578181261,-15.79803586,-8.89305536,-18.17509906,-10.67615779,-13.84388611,-11.82985743,-9.934125849,-16.09364917,-12.87090614,-14.19063401,-13.26761914,-9.697609947,-9.655724449,-13.66661771,-9.970956713,-10.36183388,-17.21151717,-10.99658705,-9.944555674,-12.39093994,-16.80225697,-11.83087863,-12.78392607,-13.81864441,-12.17226008,-8.114808157,-12.54580127,-6.592098585,-11.36581301,-12.54462807,-12.54857998,-12.35778787,-7.253347597,-9.650918631,-9.422929121,-12.77856801,-7.648649763,-6.733046897,-12.49109,-14.21742219,-7.771133739,-12.15042201,-10.3900627,-8.564564365,-14.57825576,-7.310295876,-7.889048724,-7.817185212,-10.56187672,-11.76389578,-6.684944676,-11.55109356,-11.15910448,-9.390523745,-11.64097508,-10.53034685,-9.233113991,-7.316321391,-10.05850884,-12.18886646,-7.380067789,-17.82745953,-11.4905099,-10.33417835,-6.932553947,-11.88775618,-8.091778097,-7.157067066,-11.44707318,-12.29993857,-8.513493821,-9.147897534,-7.786999504,-7.884951857,-11.24355924,-13.34653507,-9.159950478,-11.00499275,-8.858779775,-10.38321937,-9.099947834,-9.712388219,-8.535987974,-10.10201611,-11.48921845,-12.51824397,-10.79604478,-10.70680489,-9.1336021,-7.841392792,-7.730081915,-10.98753767,-10.84235509,-7.566073919,-11.00629406,-10.51374269,-5.459001066,-10.79977745,-4.864566963,-11.99839332,-6.626763242,-11.97347925,-12.03359799,-9.319157925,-10.43053472,-12.28379368,-10.47498987,-11.7892016,-11.01455173,-7.657563137,-12.87009977,-9.229517556,-10.73551587,-10.14923749,-9.687215708,-10.49769823,-12.89756685,-10.00566691,-7.265307857,-6.239977801,-10.08639847,-7.920222435,-9.967592558,-8.708744705,-7.182015088,-10.89613667,-6.424999,-10.82471437,-6.926067136,-10.53183996,-9.23989464,-10.61886285,-6.267243964,-10.02829583,-7.822722839,-10.77947538,-10.83882592,-8.813183332,-9.727572527,-11.37442515,-9.763237763,-10.94596754,-7.001583536,-4.905811102,-7.905397263,-9.84159217,-13.90475449,-5.909623635,-7.227380461,-8.107073901,-10.35291366,-9.09597004,-9.086978322,-6.404850108,-8.788477337,-8.430753906,-8.425613965,-6.523066454,-10.12387141,-9.747977327,-11.06937397,-6.479549492,-8.284549724,-7.646154007,-9.222936916,-12.02730334,-6.361794939,-8.306645637,-10.66654412,-6.537730645,-7.948954078,-6.854118849,-6.638949701,-8.517647807,-8.240677968,-6.088281427,-6.286809355,-5.908484101,-7.036521781,-8.410662647,-6.774807433,-8.516088909,-6.434791959,-11.09520072,-8.345789309,-8.529041123,-6.876741126,-7.217394087,-8.949361374,-7.597080794,-9.063701093,-7.573204783,-9.191132926,-8.191266724,-7.650341323,-7.563254895,-7.017428584,-7.224897941,-8.38452376,-7.413055098,-9.683116081,-8.325133321,-7.223258738,-6.1370025,-9.795015879,-7.646734574,-6.035501811,-9.811345366,-6.137340858,-7.999503113,-6.338481196,-6.141287851,-5.979229229,-8.656724325,-6.942374954,-9.299289562,-8.118263986,-6.910608855,-6.465239254,-10.21594458,-6.419866109,-6.566310343,-9.236972068,-8.369201766,-8.677107717,-7.108816777,-9.3604964,-5.796411659,-6.01852709,-6.892866845,-7.788394074,-7.947200038,-5.835984571,-6.483588095,-6.511267154,-8.797395332,-9.236668917,-6.397547961,-5.949477323,-6.871929822,-7.500336529,-8.019598781,-6.724487071,-8.275775247,-6.215862705,-7.60054042,-8.637426593,-5.921300905,-7.594632944,-8.417874731,-5.798957205,-7.680280775,-10.54008366,-8.145151441,-7.201214776,-7.523272286,-8.993988102,-8.25507041,-15.4366252,-6.784638288,-7.508285945,-7.003370686,-6.495052837,-8.166167444,-7.873234045,-7.618139553,-8.368297989,-5.643142061,-6.137470047,-6.982769967,-7.981157147,-6.584010613,-7.509925998,-8.543336272,-7.693353712,-7.386803268,-5.997880701,-6.59682922,-10.00591077,-6.92004007,-9.126263086,-7.539018653,-7.378570634,-6.188742229,-5.505110683,-6.058917194,-7.454541493,-9.837649929,-9.566166435,-7.427667594,-6.0455222,-5.247484692,-6.586526132,-6.338673448,-7.07777813,-7.038467884,-6.969905852,-8.437234776,-6.859694987,-6.771555454,-7.897449747,-7.692682139,-4.697828244,-6.520681411,-5.991721319,-6.630344511,-5.316962555,-7.370484399,-4.593281626,-7.00701655,-6.118229703,-7.440589104,-6.016723437,-5.510650042,-5.376371601,-6.258182708,-5.040896597,-4.757775056,-7.204287783,-8.637012516,-4.76296687,-5.058404412,-7.214169459,-5.776401834,-5.342806782,-7.774338716,-9.06253466,-6.879608714,-6.635687076,-6.503345139,-4.030236384,-6.246488872,-5.199306168,-4.679043555,-7.057146379,-6.73649766,-5.173700066,-6.173176278,-6.394529464,-5.571901415,-7.898911163,-7.302900876,-4.607043301,-5.943194742,-4.304947722,-7.388270575,-6.230419219,-5.677452911,-6.955316901,-6.84428114,-5.919488763,-6.195090784,-7.334155135,-5.634425657,-5.324125861,-5.991024675,-6.616506785,-6.533160567,-5.039537396,-6.426464557,-7.38957097,-10.04305262,-5.961474656,-4.871144038,-5.446547721,-4.916570142,-9.516000254,-7.676030899,-4.857390101,-5.241665054,-6.241815497,-5.324406941,-4.564415198,-4.56603773,-8.748144446,-4.911012128,-5.545808274,-5.945526925,-4.900843489,-5.173732291,-4.745151631,-5.4560006,-5.519296857,-5.508447723,-5.514028761,-5.690554054,-6.56447068,-7.26602443,-5.077943014,-5.701708471,-5.204510269,-6.464050252,-8.163633882,-4.935922178,-4.850733095,-7.427116725,-5.079797885,-8.481326025,-4.862876126,-4.666251304,-5.163264836,-8.513964735,-6.026632039,-5.058871308,-7.055642101,-7.895109615,-4.992658159,-6.333684063,-5.375149136,-5.239832175,-5.529172746,-5.650051662,-6.078542355,-5.730243065,-5.974449173,-6.065544273,-5.181275363,-6.21048346,-8.316417551,-5.311114827,-5.789495519,-8.491690077,-5.128834371,-6.586985182,-4.842484999,-5.589421042,-5.697530963,-4.649607448,-3.635644211,-6.388137212,-7.634868428,-7.475414784,-4.673223329,-8.008121442,-5.373040275,-3.948556124,-4.805024156,-3.649655834,-4.979681453,-7.545527422,-4.967519525,-4.903992046,-3.658062875,-5.116764829,-5.653062206,-4.67792074,-4.000094584,-5.211750718,-6.327456541,-5.511063027,-4.525453382,-4.796644648,-5.119427944,-4.80998736,-5.006608057,-4.664447329,-2.937604851,-4.167863278,-4.755121074,-4.898344909,-4.318027161,-9.528011247,-4.355316117,-4.720882878,-5.981938079,-3.214409008,-4.287135799,-4.476664762,-4.807639342,-4.673543964,-7.839794099,-3.980466316,-5.781866474,-4.781048025,-4.60268943,-5.008426179,-3.671659993,-3.35951962,-3.66842487,-4.72827088,-4.546658998,-4.018768008,-3.628301516,-4.181935458,-3.830134948,-4.163617356,-7.028302341,-4.590958953,-4.218577728,-3.299452357,-4.635032577,-3.902308969,-3.548456996,-6.98213272,-3.732623339,-3.421488038,-3.681878935,-3.744465119,-3.880309102,-4.563257733,-3.031854281,-3.518553945,-4.246077205,-3.601739041,-6.195067899,-6.335620852,-4.747855868,-3.50320505,-3.348597395,-3.8656898,-3.55748495,-3.345399623,-3.172499213,-3.501518035,-6.393712561,-3.590021733,-3.505734646,-3.479824485,-3.652246853,-5.371306853,-4.095308197,-7.699261269,-3.582422331,-3.499453333,-3.129599062,-2.433768703,-4.59831653,-4.419687352,-4.444383853,-3.362401795]

; ADD GAIA targets
plntfile = result_path + 'GAIA_list_v2.txt'
tmp = READ_ASCII(plntfile, DATA_START=1, DELIMITER=',', HEADER=hdr)
data = tmp.field01
angsep   = data[0,*]
contrast = data[1,*]
n_pt = N_ELEMENTS(angsep)
idx = FLOOR(n_pt * RANDOMU(seed, 5))
idx = INDGEN(n_pt)
angsep = angsep[idx]
contrast = contrast[idx]
;OPLOT, angsep, contrast, PSYM=6, COLOR=5
angsep = 15*RANDOMU(seed, 10)^3
contrast = 5D-4*RANDOMU(seed, 10)^3
PLOTSYM, 4, 1, /FILL
OPLOT, angsep, contrast, PSYM=8, COLOR=5

; Plot exoplanet catalog
n      = N_ELEMENTS(p_ang)
color  = FLOOR(255*p_teff/MAX(p_teff))
size_p = 0.6 + 2.5*p_rad/MAX(p_rad)
scalef = 1.2
A = FINDGEN(17) * (!PI*2/16.)
USERSYM, scalef*COS(A), scalef*SIN(A), /FILL
idx = WHERE(s_dec LT 36. AND s_dec GT -84., n_hi5 , COMPLEMENT=idx_out)
size_p[idx_out] = 0
LOADCT, 4, /SILENT
FOR i = 0, n-1 DO OPLOT, [p_ang[i]], [ctr[i]], COLOR=color[i], PSYM=8, SYMSIZE=size_p[i]
LOADCT, 13, /SILENT

idx = WHERE(p_ang GT vlt_res AND s_dec LT 45 AND ctr GE 1D-5 AND p_ang LT 100., n_hi5 , COMPLEMENT=idx_out)
;OPLOT, p_ang[idx], ctr[idx], COLOR=255, PSYM=2, SYMSIZE=0.2
;OPLOT, [0.01,1D4], [2D-3,2D-3], COLOR=185, LINESTYLE=1, SYMSIZE=1.2
;OPLOT, [0.01,1D4], [2D-4,2D-4], COLOR=185, LINESTYLE=1, SYMSIZE=1.2
;OPLOT, [0.01,1D4], [1D-5,1D-5], COLOR=255, LINESTYLE=1, SYMSIZE=1.2
;OPLOT, [0.01,1D4], [2D-6,2D-6], COLOR=185, LINESTYLE=1, SYMSIZE=1.2

show_instr = 1
IF show_instr EQ 1 THEN BEGIN
  fac = 2.4
  ;OPLOT, [40], [5D-4], COLOR=40, PSYM=7, SYMSIZE=0.8
  ;OPLOT, [35], [1D-4], COLOR=40, PSYM=7, SYMSIZE=0.8
  ;OPLOT, x3, y3, COLOR=40, LINESTYLE=0
  OPLOT, x2/fac, y2, COLOR=40, LINESTYLE=1
  OPLOT, x/fac, y, COLOR=40, LINESTYLE=0
  XYOUTS, [275]/fac, [2D-4], 'Coronagraphy', COLOR=40, SIZE=1.1, ORIENTATION=307
  XYOUTS, [290]/fac, [6D-5], '(10-m)', COLOR=40, SIZE=1.1, ORIENTATION=307
  XYOUTS, [61]/fac, [1.8D-4], 'NRM', COLOR=40, SIZE=1.1
  ;XYOUTS, [45], [5D-4], 'Nulling N-band', COLOR=40, SIZE=0.8
  ;XYOUTS, [38], [8D-5], 'Nulling K-band', COLOR=40, SIZE=0.8
ENDIF


;XYOUTS, [0.06], [2.5D-3], 'V!e2!n and CP', COLOR=180, SIZE=1.1
;XYOUTS, [0.06], [!D-4], ':ini;u; reauire;ents', COLOR=180, SIZE=1.1
;XYOUTS, [0.06], [2.5D-5], 'Null + FSC', COLOR=180, SIZE=1.1
;XYOUTS, [0.06], [2.5D-6], 'Null + FSC + HDS', COLOR=180, SIZE=1.1
;XYOUTS, [1.2], [2.4D-3], 'VLTI and CHARA', COLOR=40, SIZE=1.1
OPLOT, [elt_res,elt_res], yrange, LINESTYLE=2, COLOR=90 & XYOUTS, 0.9*elt_res, 0.0023, "ELT's IWA @ 2.2um", ORIENTATION=90, SIZE=0.8, COLOR=90 ;@ 3.8!9m!7m
OPLOT, [nac_res,nac_res], yrange, LINESTYLE=2, COLOR=90 & XYOUTS, 0.9*nac_res, 0.0023, "VLT's IWA @ 2.2um", ORIENTATION=90, SIZE=0.8, COLOR=90
OPLOT, [vlt_res,vlt_res], yrange, LINESTYLE=2, COLOR=90 & XYOUTS, 0.9*vlt_res, 0.0020, "VLTI's IWA @ 2.2um", ORIENTATION=90, SIZE=0.8, COLOR=90
;ARROW, 2.0, 2.4D-3, 2.00, 5.4D-4, /DATA, COLOR=40, THICK=5
;ARROW, 25, 3.95D-4, 2.00, 3D-5, /DATA, COLOR=90, THICK=5 & XYOUTS, 3, 4.5D-4, "Hi-5", COLOR=90, SIZE=1.1
;OPLOT, [170,190]*1D-3, [0.012,0.012], COLOR=150, THICK=50 & XYOUTS, 143*1D-3, 0.0105, ' MID-IR', COLOR=150, CHARSIZE=1.1
;OPLOT, [170,190]*1D-3, [0.026,0.026], COLOR=100, THICK=50 & XYOUTS, 105*1D-3, 0.023, 'THERMAL NEAR-IR', COLOR=100, CHARSIZE=1.1
;OPLOT, [170,190]*1D-3, [0.056,0.056], COLOR=40, THICK=50  & XYOUTS, 141*1D-3, 0.0505, 'NEAR-IR', COLOR=40, CHARSIZE=1.1

IF show_instr NE 1 THEN BEGIN
COLORBAR, BOTTOM=bottom, CHARSIZE=1.2, COLOR=4, DIVISIONS=divisions, $
          FORMAT=format, POSITION=[0.88,0.2,0.92,0.45], MAXRANGE=MAX(p_teff), MINRANGE=MIN(p_teff), NCOLORS=ncolors, $
          TITLE='T[K]', TOP=top, RIGHT=right, MINOR=minor, $
          RANGE=range, FONT=font, TICKLEN=ticklen, _EXTRA=extra, INVERTCOLORS=invertcolors, $
          TICKNAMES=ticknames, REVERSE=reverse, ANNOTATECOLOR=annotatecolor, XLOG=xlog, YLOG=ylog, $
          NODISPLAY=nodisplay, /VERTICAL
ENDIF
  
DEVICE, /CLOSE & END_PS


; Plot histograms
idx = WHERE(p_ang GT vlt_res AND s_dec LT 36. AND s_dec GT -84. AND ctr GE 1D-5 AND p_ang LT 100., n_hi5 , COMPLEMENT=idx_out)

PRINT, 'Number of Hi-5 target', n_hi5
FOR i=0, n_hi5-1 DO PRINT, s_name[idx[i]], s_km[idx[i]], s_vm[idx[i]],  s_teff[idx[i]], p_rad[idx[i]], p_teff[idx[i]], p_sma[idx[i]], p_ang[idx[i]], ctr[idx[i]], ' ', s_met[idx[i]], n_spec[idx[i]]
WRITE_CSV, 'hi5_list.csv', s_name[idx], s_km[idx], s_vm[idx],  p_rad[idx], p_teff[idx], p_sma[idx], ctr[idx], n_spec[idx]


x2 = [[p_rad[idx]], [p_mass[idx]], [p_sma[idx]], [p_ang[idx]], [p_teff[idx]], [ctr[idx]]]
title = ['Planet radius [' + TEX2IDL('R$_{\rm Jup}$') + ']', 'Planet mass [' + TEX2IDL('M$_{\rm Jup}$') + ']', 'Semi-major axis [AU]', 'Angular separation [mas]', 'Planet temperature [K]', 'Contrast']
!P.Multi=[0,1,1]
FOR i = 0, 5 DO BEGIN
  x1     = x2[*,i]
  xrange = [MIN(x1), MAX(x1)]
  yrange = [0, N_ELEMENTS(x1)]
  
  
  hist = HISTOGRAM(x1, LOCATIONS=bins, NBINS=SQRT(n_hi5))
  LOADCT, 0, /SILENT
  PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'planet_histogram' + STRING(i+1, FORMAT='(I0)') + '.eps', /ENCAPS, /COLOR, XSIZE=24.8, YSIZE=17.2, /TIMES
  PLOT, bins, hist, XTITLE=title[i], YTITLE='Occurence', TITLE='Hi-5 planet population', XSTYLE=1, YSTYLE=1, CHARSIZE= 2.2, COLOR=0, XRANGE=xrange, YRANGE=yrange, /NODATA
  binsize = bins[1]-bins[0]
  OPLOT, bins, hist, THICK=10, PSYM=10;
  LOADCT, 4, /SILENT
  start = xrange[0] - 0.5*binsize
  endpt = start + binsize
  log = 0
  FOR j=0,N_Elements(hist)-1 DO BEGIN   
     x = [start, start, endpt, endpt, start]
     IF log THEN BEGIN
        y = [1, hist[j], hist[j], 1, 1]
     ENDIF ELSE BEGIN
        y = [0, hist[j], hist[j], 0, 0]
    ENDELSE
    PolyFill, x, y, COLOR=90, ORIENTATION=orient, $
       PATTERN=pattern, SPACING=space, NOCLIP=0, THICK=line_thick
    start = start + binsize
    endpt = start + binsize
 ENDFOR
  DEVICE, /CLOSE & END_PS
ENDFOR

; Plot mass vs physical separatio
p_rad = p_rad*rjup/rear
LOADCT, 0, /SILENT
PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'planet_population.eps', /ENCAPS, /COLOR, XSIZE=24.8, YSIZE=17.2, /TIMES
!P.FONT=1 ; Required for oplus 
PLOT, p_sma, p_rad, XTITLE='Semi-major axis [AU]', YTITLE='Planet radius [' + TEX2IDL('R$_\oplus$') + ']', CHARSIZE=2.2, XSTYLE=1, YSTYLE=1, COLOR=0, XRANGE=[0.003,200.0], YRANGE=[0.25,50.0], /YLOG, /XLOG, /NODATA
LOADCT, 4, /SILENT
color  = FLOOR(255*p_teff/MAX(p_teff))
size_p = 0.6 + 2.5*ALOG10(s_lum)/MAX(ALOG10(s_lum))
USERSYM, scalef*COS(A), scalef*SIN(A), /FILL
n_p = N_ELEMENTS(p_rad)
FOR i=0, n_p-1 DO OPLOT, [p_sma[i]], [p_rad[i]], COLOR=color[i], PSYM=8, SYMSIZE=size_p[i]
COLORBAR, BOTTOM=bottom, CHARSIZE=1.6, COLOR=4, DIVISIONS=divisions, $
          FORMAT=format, POSITION=[0.86,0.25,0.90,0.6], MAXRANGE=MAX(p_teff), MINRANGE=MIN(p_teff), NCOLORS=ncolors, $
          TITLE='Temp. [K]', TOP=top, RIGHT=right, MINOR=minor, $
          RANGE=range, FONT=font, TICKLEN=ticklen, _EXTRA=extra, INVERTCOLORS=invertcolors, $
          TICKNAMES=ticknames, REVERSE=reverse, ANNOTATECOLOR=annotatecolor, XLOG=xlog, YLOG=ylog, $
          NODISPLAY=nodisplay, /VERTICAL
DEVICE, /CLOSE & END_PS

LOADCT, 0, /SILENT
PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'planet_population_histo.eps', /ENCAPS, /COLOR, XSIZE=12.8, YSIZE=17.2, /TIMES
!P.FONT=1 ; Required for oplus
PLOT, hist, bins, XTITLE='Occurence', YTITLE='', CHARSIZE=2.2, XSTYLE=1, YSTYLE=1, COLOR=0, XRANGE=[0, MAX(hist)], YRANGE=[0.25,50.], /YLOG, /NODATA
LOADCT, 13, /SILENT
OPLOT, hist, bins, COLOR=255, PSYM=10
DEVICE, /CLOSE & END_PS


; Now the HDS plot
xrange = [-1.,1.]*0.250
yrange = [1D-9,2]
np     = 1D4
xcoord = xrange[0] + (xrange[1]-xrange[0])*DINDGEN(np)/(np-1)
lam    = 3.8D-6
diam   = 8.2
ratio  = 0.01
a2r    = 1D3*m2r

; First, seeing limited
seeing  = 0.6
v_space = 0.02
z       = !DPI*(xcoord*a2r)/(1.75*seeing*1D3*m2r)
ycoord  = (2.*BESELJ(abs(z),1)/abs(z))^2

!P.Multi=[0,3,1]
PREP_PS, /VERYBOLD & DEVICE, FILEN=result_path + 'hi5_diagram3.eps', /ENCAPS, /COLOR, XSIZE=24.8, YSIZE=10.2, /TIMES
PLOT, xcoord, ycoord, /YLOG, XTITLE='Angular separation [mas]', YTITLE='1-!9s!7 contrast', TITLE='High-dispersion spectroscopy (HDS)', XSTYLE=1, YSTYLE=1, COLOR=0, POSITION=[0.05,0.1,0.36,0.9],$
      YTICKNAME=ytickname, XRANGE=xrange, YRANGE=yrange, YTICKFORMAT='logticks_exp' , /NODATA
LOADCT, 4, /SILENT
OPLOT, xcoord, ycoord, LINESTYLE=0, COLOR=40
ARROW, 0, 0.9, 0, 1D-4, COLOR=40, /DATA, THICK=5, HSIZE=!D.X_SIZE / 32., HTHICK=5
OPLOT, xrange, [1D-4,1D-4], LINESTYLE=1
XYOUTS, xrange[0]+v_space, 0.4, "Seeing = 0.6''"
XYOUTS, xrange[0]+v_space, 1.5D-4, 'limit=10!e-4!n'
XYOUTS, v_space, 1D-1, '1:10000', ORIENTATION=-90, COLOR=40

; Now AO assisted
z      = !DPI*diam*xcoord*a2r/lam
ycoord = (2.*BESELJ(abs(z),1)/abs(z))^2

alpha  = 265D4
beta   = 2.5D-4
kernel = (1+(xcoord*a2r/alpha)^2)^(-1*beta)

ycoord = (ycoord + kernel)
null   = ycoord * 2D-4

PLOT, xcoord, ycoord, /YLOG, XTITLE='Angular separation [mas]',  TITLE='Nulling interferometry', XSTYLE=1, YSTYLE=1, COLOR=0, POSITION=[0.36,0.1,0.67,0.9],$
      YTICKNAME=[' ',' ',' ',' ', ' '], XRANGE=xrange, YRANGE=yrange,  /NODATA
LOADCT, 4, /SILENT
OPLOT, xcoord, ycoord, LINESTYLE=0, COLOR=40
OPLOT, xcoord, null, LINESTYLE=0, COLOR=40
ARROW, 0, 0.9, 0, 1D-4, COLOR=40, /DATA, THICK=5, HSIZE=!D.X_SIZE / 32., HTHICK=5
OPLOT, xrange, [1D-4,1D-4], LINESTYLE=1
XYOUTS, xrange[0]+v_space, 1.5D-4, 'limit=10!e-4!n'
XYOUTS, v_space, 1D-1, '1:10000', ORIENTATION=-90, COLOR=40

PLOT, xcoord, ycoord, /YLOG, XTITLE='Angular separation [mas]', TITLE='Nulling + HDS', XSTYLE=1, YSTYLE=1, COLOR=0, POSITION=[0.67,0.1,0.98,0.9],$
      YTICKNAME=[' ',' ',' ',' ', ' '], XRANGE=xrange, YRANGE=yrange, /NODATA
LOADCT, 4, /SILENT
OPLOT, xcoord, ycoord, LINESTYLE=0, COLOR=40
ARROW, 0, 0.9, 0, 1D-4, COLOR=40, /DATA, THICK=5, HSIZE=!D.X_SIZE / 32., HTHICK=5
OPLOT, xrange, [1D-4,1D-4], LINESTYLE=1
XYOUTS, xrange[0]+v_space, 1.5D-4, 'limit=10!e-4!n'
XYOUTS, v_space, 1D-1, '1:10000', ORIENTATION=-90, COLOR=40
DEVICE, /CLOSE & END_PS
!P.Multi = 0

END